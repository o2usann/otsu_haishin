<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>応援pt入力</title>
<style>
  body { background:#111; color:#fff; font-family:system-ui,sans-serif; padding:10px; }
  .row { display:flex; gap:8px; }
  input { width:100%; font-size:16px; padding:10px; margin:0 0 10px; border-radius:10px; border:1px solid #333; background:#0b0b0b; color:#fff; }
  button { flex:1; padding:12px; font-size:16px; border:0; border-radius:12px; cursor:pointer; color:#fff; }
  .b150 { background:#2e7d32; }
  .b500 { background:#1565c0; }
  .b3000 { background:#8e24aa; }
  .hint { color:#aaa; font-size:12px; margin-top:8px; }
  #msg { margin-top:10px; font-size:12px; color:#9fe; }
</style>
</head>
<body>
  <input id="name" placeholder="視聴者名（例: examおつゆ）" />
  <div class="row">
    <button class="b150"  onclick="send(150)">応援(梅)</button>
    <button class="b500"  onclick="send(500)">応援(竹)</button>
    <button class="b3000" onclick="send(3000)">応援(松)</button>
  </div>
  <div class="hint">名前だけ入力 → ボタンで固定pt追加</div>
  <div id="msg"></div>

<script>
  const API = "http://127.0.0.1:8787/add";

  async function send(pt){
    const name = document.getElementById("name").value.trim();
    const msg = document.getElementById("msg");
    if(!name){
      alert("名前を入力してね");
      return;
    }

    // 即UI更新（体感速度最優先）
    msg.textContent = `送信: ${name} +${pt}`;

    // タイムアウト設定（OBS対策）
    const controller = new AbortController();
    setTimeout(() => controller.abort(), 1500);

    try {
      await fetch(API, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({name, pt}),
        signal: controller.signal
      });
      // 成功扱い（レスポンス待たない）
      msg.textContent = `OK: ${name} +${pt}`;
    } catch (e) {
      // 実際は成功してることが多い
      msg.textContent = `送信済み（反映待ち）`;
    }
  }
</script>

</body>
</html>
